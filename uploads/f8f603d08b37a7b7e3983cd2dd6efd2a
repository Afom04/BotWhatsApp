CREATE DATABASE eps;
USE eps;

CREATE TABLE usuarios (
	id_usuario INT PRIMARY KEY NOT NULL ,
	correo_usuario VARCHAR(100) NOT NULL,
	password VARCHAR(64) NOT NULL,
	estado BOOL NOT NULL CHECK (estado IN (0,1)),
	token text
);

CREATE TABLE ciudad(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(255)
);

CREATE TABLE paciente (
	id_paciente INT PRIMARY KEY AUTO_INCREMENT,
	nombres VARCHAR(255) NOT NULL,
	apellidos VARCHAR(255) NOT NULL,
	fecha_naci DATE NOT NULL,
	lugar_naci INT NOT NULL,
	direccion_re VARCHAR(255) NOT NULL,
	direccion_cor VARCHAR(255),
	estrato INT NOT NULL,
	ciudad_resi INT NOT NULL,
	ciudad_afili INT NOT NULL, 
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
	FOREIGN KEY (lugar_naci) REFERENCES ciudad(id),
	FOREIGN KEY (ciudad_resi) REFERENCES ciudad(id),
	FOREIGN KEY (ciudad_afili) REFERENCES ciudad(id)
);
CREATE TABLE telefono_paciente(
	id_paciente INT NOT NULL,
	telefonos varchar(255),
	PRIMARY KEY(id_paciente,telefonos),
	FOREIGN KEY (id_paciente) REFERENCES paciente(id_paciente) ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE especialidad(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(100) NOT NULL
);
CREATE TABLE tipo_licencia(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(50)
);
CREATE TABLE medico (
	id_medico INT PRIMARY KEY AUTO_INCREMENT,
	nombre VARCHAR(255) NOT NULL,
	direccion VARCHAR(255) NOT NULL,
	ciudad INT NOT NULL,
	licencia_medica VARCHAR(50) NOT NULL, 
	especialidad INT NOT NULL,
	tipo_licencia INT NOT NULL,  
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
	FOREIGN KEY (ciudad) REFERENCES ciudad(id),
	FOREIGN KEY (tipo_licencia) REFERENCES tipo_licencia(id),
	FOREIGN KEY (especialidad) REFERENCES especialidad(id)
);
CREATE TABLE telefono_medico (
	id_medico INT NOT NULL,
	telefonos VARCHAR(255) NOT NULL,
	PRIMARY KEY(id_medico, telefonos),
CREATE DATABASE eps;
USE eps;

CREATE TABLE usuarios (
	id_usuario INT PRIMARY KEY NOT NULL ,
	correo_usuario VARCHAR(100) NOT NULL,
	password VARCHAR(64) NOT NULL,
	estado BOOL NOT NULL CHECK (estado IN (0,1)),
	token text
);

CREATE TABLE ciudad(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(255)
);

CREATE TABLE paciente (
	id_paciente INT PRIMARY KEY AUTO_INCREMENT,
	nombres VARCHAR(255) NOT NULL,
	apellidos VARCHAR(255) NOT NULL,
	fecha_naci DATE NOT NULL,
	lugar_naci INT NOT NULL,
	direccion_re VARCHAR(255) NOT NULL,
	direccion_cor VARCHAR(255),
	estrato INT NOT NULL,
	ciudad_resi INT NOT NULL,
	ciudad_afili INT NOT NULL, 
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
	FOREIGN KEY (lugar_naci) REFERENCES ciudad(id),
	FOREIGN KEY (ciudad_resi) REFERENCES ciudad(id),
	FOREIGN KEY (ciudad_afili) REFERENCES ciudad(id)
);
CREATE TABLE telefono_paciente(
	id_paciente INT NOT NULL,
	telefonos varchar(255),
	PRIMARY KEY(id_paciente,telefonos),
	FOREIGN KEY (id_paciente) REFERENCES paciente(id_paciente) ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE especialidad(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(100) NOT NULL
);
CREATE TABLE tipo_licencia(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(50)
);
CREATE TABLE medico (
	id_medico INT PRIMARY KEY AUTO_INCREMENT,
	nombre VARCHAR(255) NOT NULL,
	direccion VARCHAR(255) NOT NULL,
	ciudad INT NOT NULL,
	licencia_medica VARCHAR(50) NOT NULL, 
	especialidad INT NOT NULL,
	tipo_licencia INT NOT NULL,  
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
	FOREIGN KEY (ciudad) REFERENCES ciudad(id),
	FOREIGN KEY (tipo_licencia) REFERENCES tipo_licencia(id),
	FOREIGN KEY (especialidad) REFERENCES especialidad(id)
);
CREATE TABLE telefono_medico (
	id_medico INT NOT NULL,
	telefonos VARCHAR(255) NOT NULL,
	PRIMARY KEY(id_medico, telefonos),
	FOREIGN KEY (id_medico) REFERENCES medico(id_medico) ON DELETE CASCADE ON UPDATE CASCADE
);
CREATE TABLE modalidad_consulta (
	id_modalidad INT PRIMARY KEY,
	tipo VARCHAR(100) NOT NULL
);
CREATE TABLE sede (
	id_sede INT PRIMARY KEY,
	nombre VARCHAR(255) NOT NULL,
	ciudad INT NOT NULL,
	direccion VARCHAR(255) NOT NULL,
	telefono_sede INT NOT NULL,
	FOREIGN KEY (ciudad) REFERENCES ciudad(id)
);
CREATE TABLE cita (
	id_cita INT PRIMARY KEY AUTO_INCREMENT,
	fecha_hora TIMESTAMP NOT NULL,
	id_paciente INT NOT NULL,
	id_medico INT NOT NULL,
	id_sede INT NOT NULL,
	id_modalidad INT NOT NULL,
	asistencia BOOLEAN,
	FOREIGN KEY (id_paciente) REFERENCES paciente(id_paciente),
	FOREIGN KEY (id_medico) REFERENCES medico(id_medico),
	FOREIGN KEY (id_sede) REFERENCES sede(id_sede),
	FOREIGN KEY (id_modalidad) REFERENCES modalidad_consulta(id_modalidad)
);
CREATE TABLE diagnostico (
	id_diagnostico SERIAL PRIMARY KEY,
	id_cita INT NOT NULL,
	descripcion TEXT NOT NULL,
	fecha DATE NOT NULL,
	FOREIGN KEY (id_cita) REFERENCES cita(id_cita) ON DELETE CASCADE
);
CREATE TABLE examen(
	id INT NOT NULL PRIMARY KEY,
	nombre VARCHAR(50) NOT NULL
);
CREATE TABLE examen_cita (
	id_examen INT NOT NULL,
	id_cita INT NOT NULL,
	tipo VARCHAR(255) NOT NULL,
	resultado TEXT,
	PRIMARY KEY (id_cita),
	FOREIGN KEY (id_cita) REFERENCES cita(id_cita) ON DELETE CASCADE,
	FOREIGN KEY (id_examen) REFERENCES examen(id) 
);
CREATE TABLE admin (
	id_admin INT PRIMARY KEY AUTO_INCREMENT,
	nombre VARCHAR(255) NOT NULL,
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario)
);